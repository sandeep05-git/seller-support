<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Talking Character - Realistic Lips & Shake + Language Switch</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f0f0f0;
    padding: 20px;
  }

  #controls {
    margin-bottom: 15px;
  }

  select, textarea, button {
    padding: 10px;
    font-size: 16px;
    margin: 10px;
  }

  #characterContainer {
    position: relative;
    width: 400px;
    height: 300px;
    margin: 0 auto;
    overflow: visible;
  }

  #characterImage {
    width: 100%;
    height: auto;
    display: block;
    position: relative;
  }

  /* Shake animation */
  .shake {
    animation: shake 0.2s infinite;
  }

  @keyframes shake {
    0% { transform: translate(1px, 1px); }
    25% { transform: translate(-1px, 2px); }
    50% { transform: translate(2px, -1px); }
    75% { transform: translate(-2px, 1px); }
    100% { transform: translate(1px, -2px); }
  }

  /* Mouth realistic shape */
  #mouth {
    position: absolute;
    bottom: 70px; /* adjust to mouth position on image */
    left: 160px;  /* adjust to mouth position on image */
    width: 80px;
    height: 30px;
    background: black;
    border-radius: 50% / 60%;
    transition: height 0.1s ease;
  }

  #mouth.open {
    height: 50px;
    background: #800000;
    border-radius: 50% / 40%;
  }
</style>
</head>
<body>

<h2>Talking Character - Realistic Lips + Shake + Language Switch</h2>

<div id="controls">
  <select id="language">
    <option value="en-IN">English</option>
    <option value="hi-IN">Hindi</option>
  </select><br>

  <textarea id="scriptBox" rows="4" cols="60" placeholder="Type your script here...">Hello, this is a seller support demo in English.</textarea><br>

  <button onclick="startTalking()">Start Talking</button>
  <button onclick="stopTalking()">Stop Talking</button>
</div>

<div id="characterContainer">
  <img
    id="characterImage"
    src="https://raw.githubusercontent.com/sandeep05-git/animated-video.html/main/ChatGPT%20Image%20May%2024%2C%202025%2C%2012_50_11%20PM.png"
    alt="Character"
  />
  <div id="mouth"></div>
</div>

<script>
  const languageSelect = document.getElementById('language');
  const scriptBox = document.getElementById('scriptBox');
  const characterImage = document.getElementById('characterImage');
  const mouth = document.getElementById('mouth');
  const characterContainer = document.getElementById('characterContainer');

  let synth = window.speechSynthesis;
  let utterance;
  let mouthInterval;

  function getVoice(langCode) {
    const voices = synth.getVoices();
    // Filter voices by language code
    return voices.find(v => v.lang === langCode) || voices.find(v => v.lang.startsWith(langCode.split('-')[0])) || voices[0];
  }

  function animateMouth(open) {
    if(open){
      mouth.classList.add('open');
    } else {
      mouth.classList.remove('open');
    }
  }

  function startMouthAnimation() {
    let open = false;
    mouthInterval = setInterval(() => {
      open = !open;
      animateMouth(open);
    }, 200);
  }

  function stopMouthAnimation() {
    clearInterval(mouthInterval);
    animateMouth(false);
  }

  function startShake() {
    characterContainer.classList.add('shake');
  }

  function stopShake() {
    characterContainer.classList.remove('shake');
  }

  function startTalking() {
    if(synth.speaking){
      alert('Speech already in progress.');
      return;
    }

    const script = scriptBox.value.trim();
    if(!script) {
      alert('Please enter script text.');
      return;
    }

    const lang = languageSelect.value;
    const voice = getVoice(lang);

    utterance = new SpeechSynthesisUtterance(script);
    utterance.lang = lang;
    if(voice) {
      utterance.voice = voice;
    }

    utterance.onstart = () => {
      startMouthAnimation();
      startShake();
    };

    utterance.onend = () => {
      stopMouthAnimation();
      stopShake();
    };

    utterance.onerror = () => {
      stopMouthAnimation();
      stopShake();
      alert('Speech synthesis error.');
    };

    synth.speak(utterance);
  }

  function stopTalking() {
    if(synth.speaking) {
      synth.cancel();
      stopMouthAnimation();
      stopShake();
    }
  }

  // Load voices asynchronously
  window.speechSynthesis.onvoiceschanged = () => {
    // Preload voices so getVoice works correctly
    getVoice(languageSelect.value);
  };

</script>

</body>
</html>
